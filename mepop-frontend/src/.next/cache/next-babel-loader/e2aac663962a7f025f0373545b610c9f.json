{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/samuelwood/development/mepop-reports/mepop-frontend/src/pages/_app.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport theme from '../theme';\nimport { ThemeProvider } from 'styled-components';\nimport 'font-awesome/css/font-awesome.css';\nimport 'react-virtualized/styles.css';\nimport '../globalStyle.css';\nimport 'react-tippy/dist/tippy.css';\nimport { Elements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Provider as ReduxProvider, useDispatch } from 'react-redux';\nimport { ToastProvider } from 'react-toast-notifications';\nimport { PageTransition } from 'next-page-transitions'; // Initialize Date Picker\n\nimport 'react-dates/initialize';\nimport 'react-dates/lib/css/_datepicker.css';\nimport '../styles/datePicker.css';\nimport Firebase, { FirebaseContext, withFirebase } from '../firebase';\nimport Layout from '../components/Layout';\nimport store from '../store';\nimport { UPDATE_USER, TOGGLE_LOADING } from '../store/generalReducer';\nimport { fetchFiles } from '../store/actions/files';\nimport { useRouter } from 'next/router';\nvar stripePromise = loadStripe('pk_live_c9rOKGsnQdeKY5fmn2gYNbiL');\nexport var MyApp = function MyApp(props) {\n  return __jsx(Elements, {\n    stripe: stripePromise,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 30,\n      columnNumber: 5\n    }\n  }, __jsx(ThemeProvider, {\n    theme: theme,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 7\n    }\n  }, __jsx(ReduxProvider, {\n    store: store,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 9\n    }\n  }, __jsx(FirebaseContext.Provider, {\n    value: new Firebase(),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 11\n    }\n  }, __jsx(ToastProvider, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 13\n    }\n  }, __jsx(Setup, _extends({}, props, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 35,\n      columnNumber: 15\n    }\n  })))))));\n};\n_c = MyApp;\nexport default MyApp; // This persists user sessions and sets up app from there.\n\nvar Setup = withFirebase(_c2 = _s(function (_ref) {\n  _s();\n\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps,\n      firebase = _ref.firebase;\n  var router = useRouter();\n  var dispatch = useDispatch();\n  var unprotectedRoute = router.pathname === '/sign-in' || router.pathname === '/sign-up';\n  useEffect(function () {\n    firebase.auth.onAuthStateChanged(function (persistedUser) {\n      var isNewUser = persistedUser ? persistedUser.metadata.creationTime === persistedUser.metadata.lastSignInTime : true;\n\n      if (persistedUser && !isNewUser) {\n        firebase.handleMembership(persistedUser).then(function (userObj) {\n          dispatch({\n            type: UPDATE_USER,\n            payload: userObj\n          });\n          dispatch({\n            type: TOGGLE_LOADING,\n            payload: true\n          });\n          fetchFiles({\n            firebase: firebase,\n            dispatch: dispatch\n          }, function () {\n            // after fetching files do this\n            dispatch({\n              type: TOGGLE_LOADING,\n              payload: false\n            });\n          });\n        });\n      } else {\n        if (!unprotectedRoute) router.push({\n          pathname: '/sign-in'\n        });\n        dispatch({\n          type: UPDATE_USER,\n          payload: {}\n        });\n        dispatch({\n          type: TOGGLE_LOADING,\n          payload: false\n        });\n      }\n    });\n  }, []);\n  return __jsx(Layout, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  }, __jsx(PageTransition, {\n    timeout: 300,\n    classNames: \"page-transition\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }\n  }, __jsx(Component, _extends({}, pageProps, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 11\n    }\n  }))));\n}, \"bjZflwr9yuHJ0eAg20MSTkw3ecc=\", false, function () {\n  return [useRouter, useDispatch];\n}));\n_c3 = Setup;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"MyApp\");\n$RefreshReg$(_c2, \"Setup$withFirebase\");\n$RefreshReg$(_c3, \"Setup\");","map":{"version":3,"sources":["/Users/samuelwood/development/mepop-reports/mepop-frontend/src/pages/_app.js"],"names":["React","useEffect","theme","ThemeProvider","Elements","loadStripe","Provider","ReduxProvider","useDispatch","ToastProvider","PageTransition","Firebase","FirebaseContext","withFirebase","Layout","store","UPDATE_USER","TOGGLE_LOADING","fetchFiles","useRouter","stripePromise","MyApp","props","Setup","Component","pageProps","firebase","router","dispatch","unprotectedRoute","pathname","auth","onAuthStateChanged","persistedUser","isNewUser","metadata","creationTime","lastSignInTime","handleMembership","then","userObj","type","payload","push"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react'\nimport theme from '../theme'\nimport { ThemeProvider } from 'styled-components'\nimport 'font-awesome/css/font-awesome.css'\nimport 'react-virtualized/styles.css'\nimport '../globalStyle.css'\nimport 'react-tippy/dist/tippy.css'\nimport { Elements } from '@stripe/react-stripe-js'\nimport { loadStripe } from '@stripe/stripe-js'\nimport { Provider as ReduxProvider, useDispatch } from 'react-redux'\nimport { ToastProvider } from 'react-toast-notifications'\nimport { PageTransition } from 'next-page-transitions'\n\n// Initialize Date Picker\nimport 'react-dates/initialize'\nimport 'react-dates/lib/css/_datepicker.css'\nimport '../styles/datePicker.css'\nimport Firebase, { FirebaseContext, withFirebase } from '../firebase'\n\nimport Layout from '../components/Layout'\n\nimport store from '../store'\nimport { UPDATE_USER, TOGGLE_LOADING } from '../store/generalReducer'\nimport { fetchFiles } from '../store/actions/files'\nimport { useRouter } from 'next/router'\n\nconst stripePromise = loadStripe('pk_live_c9rOKGsnQdeKY5fmn2gYNbiL')\nexport const MyApp = (props) => {\n  return (\n    <Elements stripe={stripePromise}>\n      <ThemeProvider theme={theme}>\n        <ReduxProvider store={store}>\n          <FirebaseContext.Provider value={new Firebase()}>\n            <ToastProvider>\n              <Setup {...props} />\n            </ToastProvider>\n          </FirebaseContext.Provider>\n        </ReduxProvider>\n      </ThemeProvider>\n    </Elements>\n\n  )\n}\n\nexport default MyApp\n\n// This persists user sessions and sets up app from there.\nconst Setup = withFirebase(({ Component, pageProps, firebase }) => {\n  const router = useRouter()\n  const dispatch = useDispatch()\n  const unprotectedRoute = router.pathname === '/sign-in' || router.pathname === '/sign-up'\n\n  useEffect(() => {\n    firebase.auth.onAuthStateChanged((persistedUser) => {\n      const isNewUser = persistedUser ? persistedUser.metadata.creationTime === persistedUser.metadata.lastSignInTime : true\n      if (persistedUser && !isNewUser) {\n        firebase.handleMembership(persistedUser).then((userObj) => {\n          dispatch({\n            type: UPDATE_USER,\n            payload: userObj\n          })\n          dispatch({\n            type: TOGGLE_LOADING,\n            payload: true\n          })\n          fetchFiles({ firebase, dispatch }, () => {\n            // after fetching files do this\n            dispatch({\n              type: TOGGLE_LOADING,\n              payload: false\n            })\n          })\n        })\n      } else {\n        if (!unprotectedRoute) router.push({ pathname: '/sign-in' })\n        dispatch({\n          type: UPDATE_USER,\n          payload: {}\n        })\n        dispatch({\n          type: TOGGLE_LOADING,\n          payload: false\n        })\n      }\n    })\n  }, [])\n  return (\n    <Layout>\n      {\n        <PageTransition timeout={300} classNames='page-transition'>\n          <Component {...pageProps} />\n        </PageTransition>\n      }\n\n    </Layout>\n  )\n})\n"]},"metadata":{},"sourceType":"module"}