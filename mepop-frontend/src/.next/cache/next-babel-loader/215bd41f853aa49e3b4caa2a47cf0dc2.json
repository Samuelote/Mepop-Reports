{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect, useMemo } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport styled from 'styled-components';\nimport moment from 'moment';\nimport Link from 'next/link';\nimport Flex from '../styles/layout/Flex';\nimport DateRangePicker from '../styles/elements/DateRangePicker';\nimport Select from '../styles/elements/Select';\nimport { getRangedData } from '../dataProcessing/utils';\nimport { UPDATE_RANGED_DATA, UPDATE_COMPARE_DATA } from '../store/generalReducer';\nimport Text from '../styles/elements/Text';\nimport Spinner from '../styles/elements/Loading/Spinner';\nimport Tooltip from '../styles/elements/Tooltip';\n\nconst DateContainer = ({\n  page\n}) => {\n  const {\n    allData,\n    loading,\n    user\n  } = useSelector(state => state.generalReducer);\n  const fixedFullRange = page === 'Dashboard';\n  const dispatch = useDispatch();\n  const min = useMemo(() => allData.sales ? allData.sales[0].date_of_sale : null, [allData]);\n  const max = useMemo(() => allData.sales ? allData.sales[allData.sales.length - 1].date_of_sale : null, [allData]);\n  const {\n    0: dateRange,\n    1: setDates\n  } = useState({\n    startDate: min,\n    endDate: max\n  }); // stored in MM-DD-YYYY format\n\n  const {\n    0: compareDateRange,\n    1: setCompareDates\n  } = useState({\n    startDate: min,\n    endDate: max\n  }); // stored in MM-DD-YYYY format\n\n  const {\n    0: preset,\n    1: setPreset\n  } = useState({\n    label: 'Full Range',\n    value: 'full'\n  });\n  const {\n    0: comparePreset,\n    1: setComparePreset\n  } = useState({\n    label: 'Full Range',\n    value: 'full'\n  });\n  const {\n    0: showCompareDate,\n    1: toggleCompare\n  } = useState(false);\n  const {\n    0: isLoading,\n    1: setLoading\n  } = useState(false);\n  const isBasic = user.membership.type === 'basic';\n  useEffect(() => {\n    if (dateRange.startDate === null || dateRange.endDate === null) {\n      setPreset({\n        label: 'Full Range',\n        value: 'full'\n      });\n      setDates({\n        startDate: min,\n        endDate: max\n      });\n    } else if (dateRange.startDate && dateRange.endDate) {\n      if (!moment(dateRange.startDate).isSame(min) && !moment(dateRange.endDate).isSame(max)) {\n        setPreset({\n          label: 'Full Range',\n          value: 'full'\n        });\n        setDates({\n          startDate: min,\n          endDate: max\n        });\n      }\n    }\n  }, [min, max]);\n  useEffect(() => {\n    setTimeout(() => {\n      if (allData.sales && dateRange.startDate && dateRange.endDate) {\n        const rangedData = getRangedData(allData, {\n          startDate: dateRange.startDate,\n          endDate: dateRange.endDate\n        });\n        dispatch({\n          type: UPDATE_RANGED_DATA,\n          payload: rangedData\n        });\n      }\n    });\n  }, [allData, dateRange]);\n  useEffect(() => {\n    setLoading(true);\n    setTimeout(() => {\n      if (allData.sales && compareDateRange.startDate && compareDateRange.endDate) {\n        const rangedData = getRangedData(allData, {\n          startDate: compareDateRange.startDate,\n          endDate: compareDateRange.endDate\n        }); // console.log(rangedData)\n\n        dispatch({\n          type: UPDATE_COMPARE_DATA,\n          payload: rangedData\n        });\n      }\n\n      if (!showCompareDate) {\n        dispatch({\n          type: UPDATE_COMPARE_DATA,\n          payload: {}\n        });\n      }\n\n      setLoading(false);\n    });\n  }, [allData, compareDateRange, showCompareDate]);\n  useEffect(() => {\n    const {\n      startDate,\n      endDate\n    } = getDatePreset(preset, min, max);\n\n    if (startDate && endDate) {\n      setDates({\n        startDate,\n        endDate\n      });\n    }\n  }, [preset]);\n  useEffect(() => {\n    const {\n      startDate,\n      endDate\n    } = getDatePreset(comparePreset, min, max);\n\n    if (startDate && endDate) {\n      setCompareDates({\n        startDate,\n        endDate\n      });\n    }\n  }, [comparePreset]);\n  if (!allData.sales) return null;\n  const btnDisabled = loading || fixedFullRange || isLoading || isBasic;\n  return __jsx(Flex, {\n    alignItems: \"center\"\n  }, __jsx(Flex, {\n    flexDirection: \"column\",\n    justifyContent: \"space-between\",\n    height: showCompareDate && !fixedFullRange ? 96 : 'auto'\n  }, __jsx(Select, {\n    opacity: fixedFullRange ? 0 : 1,\n    options: options,\n    onChange: arr => setPreset(arr[0]),\n    selectProps: {\n      values: preset ? [preset] : [],\n      disabled: fixedFullRange,\n      searchable: false,\n      style: {\n        width: '140px',\n        fontSize: '15px'\n      },\n      separator: true\n    }\n  }), showCompareDate ? __jsx(Select, {\n    opacity: fixedFullRange ? 0 : 1,\n    options: options,\n    onChange: arr => setComparePreset(arr[0]),\n    selectProps: {\n      values: comparePreset ? [comparePreset] : [],\n      disabled: fixedFullRange,\n      searchable: false,\n      style: {\n        width: '140px',\n        fontSize: '15px'\n      },\n      separator: true\n    }\n  }) : null), __jsx(Flex, {\n    flexDirection: \"column\"\n  }, __jsx(DateRangePicker, {\n    startDate: dateRange.startDate ? moment(fixedFullRange ? min : dateRange.startDate) : null,\n    endDate: dateRange.endDate ? moment(fixedFullRange ? max : dateRange.endDate) : null,\n    disabled: fixedFullRange,\n    isOutsideRange: day => {\n      console.log(day, moment(max));\n      return day.isBefore(moment(min)) || day.isAfter(moment(max));\n    },\n    enableOutsideDays: false,\n    onDatesChange: ({\n      startDate,\n      endDate\n    }) => {\n      setPreset({\n        label: 'Custom',\n        value: null\n      });\n      setDates({\n        startDate: startDate ? startDate.format('MM-DD-YYYY') : null,\n        endDate: endDate ? endDate.format('MM-DD-YYYY') : null\n      });\n    }\n  }), showCompareDate && !fixedFullRange ? __jsx(React.Fragment, null, __jsx(Text, {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    color: \"primary\",\n    fontWeight: \"100\",\n    fontSize: \"15px\"\n  }, \"vs.\"), __jsx(DateRangePicker, {\n    startDate: compareDateRange.startDate ? moment(fixedFullRange ? min : compareDateRange.startDate) : null,\n    endDate: compareDateRange.endDate ? moment(fixedFullRange ? max : compareDateRange.endDate) : null,\n    disabled: fixedFullRange,\n    isOutsideRange: day => {\n      return day.isBefore(min) || day.isAfter(max);\n    },\n    onDatesChange: ({\n      startDate,\n      endDate\n    }) => {\n      setComparePreset({\n        label: 'Custom',\n        value: null\n      });\n      setCompareDates({\n        startDate: startDate ? startDate.format('MM-DD-YYYY') : null,\n        endDate: endDate ? endDate.format('MM-DD-YYYY') : null\n      });\n    }\n  })) : null), __jsx(Tooltip, {\n    disabled: !isBasic,\n    html: __jsx(TooltipContent, null),\n    interactive: true,\n    interactiveBorder: 100\n  }, __jsx(AddBtn, {\n    isFixedFullRange: fixedFullRange,\n    onClick: () => {\n      if (btnDisabled) return;\n      toggleCompare(!showCompareDate);\n    },\n    disabled: btnDisabled\n  }, fixedFullRange ? null : loading || isLoading ? __jsx(Spinner, {\n    width: \"2em\",\n    size: 3\n  }) : __jsx(\"i\", {\n    className: showCompareDate ? 'fa fa-minus-circle' : 'fa fa-plus-circle'\n  }))));\n};\n\nexport default DateContainer;\n\nconst TooltipContent = () => {\n  return __jsx(\"div\", null, \"You must \", __jsx(Link, {\n    href: \"/settings/membership\"\n  }, __jsx(Span, {\n    title: \"/membership\"\n  }, \"upgrade\")), \" to compare date ranges\");\n};\n\nconst Span = styled.span.withConfig({\n  displayName: \"DateContainer__Span\",\n  componentId: \"sc-3ofmch-0\"\n})([\"color:white;cursor:pointer;border-bottom:1px solid white;&:hover{opacity:.7;}\"]);\nconst AddBtn = styled.span.withConfig({\n  displayName: \"DateContainer__AddBtn\",\n  componentId: \"sc-3ofmch-1\"\n})([\"color:\", \";background:none;border:none;cursor:\", \";font-size:20px;margin-top:3px;transition:\", \";height:50px;width:60px;display:flex;align-items:center;border-left:1px solid \", \";justify-content:center;&:hover{color:\", \";}\"], ({\n  theme\n}) => theme.colors.greyLight, ({\n  disabled\n}) => disabled ? 'not-allowed' : 'pointer', ({\n  theme\n}) => theme.transitionDurations[1], ({\n  theme,\n  isFixedFullRange\n}) => isFixedFullRange ? 'transparent' : theme.colors.mainBg, ({\n  theme,\n  disabled\n}) => !disabled ? theme.colors.primary : null);\nconst options = [{\n  label: 'Full Range',\n  value: 'full'\n}, {\n  label: 'This Month',\n  value: 'this_month'\n}, {\n  label: 'Last Month',\n  value: 'last_month'\n}, {\n  label: 'Past 3 Months',\n  value: 'past_three_months'\n}];\n\nconst getDatePreset = (preset, min, max) => {\n  switch (preset.value) {\n    case 'full':\n      {\n        return {\n          startDate: min,\n          endDate: max\n        };\n      }\n\n    case 'this_month':\n      {\n        const newStart = moment(moment().startOf('month')).format('MM-DD-YYYY');\n        const newEnd = moment(moment().endOf('month')).format('MM-DD-YYYY');\n        return {\n          startDate: newStart,\n          endDate: new Date(newEnd) <= new Date(max) ? newEnd : max\n        };\n      }\n\n    case 'last_month':\n      {\n        const newStart = moment(moment().subtract(1, 'months').startOf('month')).format('MM-DD-YYYY');\n        const newEnd = moment(moment().subtract(1, 'months').endOf('month')).format('MM-DD-YYYY');\n        return {\n          startDate: newStart,\n          endDate: new Date(newEnd) <= new Date(max) ? newEnd : max\n        };\n      }\n\n    case 'past_three_months':\n      {\n        const newStart = moment(moment().subtract(3, 'months')).format('MM-DD-YYYY');\n        return {\n          startDate: newStart,\n          endDate: max\n        };\n      }\n\n    default:\n      {\n        return {};\n      }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}