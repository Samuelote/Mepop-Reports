{"ast":null,"code":"import { readString } from 'react-papaparse';\nimport axios from 'axios';\nimport { headers } from '../../assets/exampleBuyers';\nimport firebase from 'firebase';\nexport const getFileMethod = (auth, storage, resolve) => {\n  const UID = auth.currentUser.uid;\n  const storageRef = storage.ref(`${UID}`);\n  storageRef.listAll().then(({\n    items\n  }) => {\n    const getDownloadPromises = [];\n    items.forEach((fileRef, i) => {\n      // pushes promises to resolve synchronously\n      getDownloadPromises.push(fileRef.getDownloadURL());\n    });\n    const calls = []; // resolves getting the download URL's then pushes axios call to calls array\n\n    Promise.all(getDownloadPromises).then(responses => {\n      responses.forEach(url => {\n        calls.push(axios.get(url));\n      }); // resolves all calls in calls array and then sets up new state array for component\n\n      axios.all(calls).then(axios.spread((...responses) => {\n        const newData = [];\n        responses.forEach((res, j) => {\n          newData.push({\n            content: res.data,\n            filename: items[j].name\n          });\n        });\n        resolve(newData);\n      })).catch(err => {\n        resolve([]);\n        console.log(err);\n        window.alert('Error occurred while retreiving files. Try again');\n      });\n    }).catch(() => {\n      resolve();\n      console.error('Error Occurred');\n      window.alert('Error Occurred');\n    });\n  }).catch(() => {\n    resolve();\n    console.error('Error Occurred');\n    window.alert('Error Occurred');\n  });\n};\nexport const deleteFileMethod = (auth, storage, filename, fetchFiles) => {\n  const UID = auth.currentUser.uid;\n  const storageRef = storage.ref(`${UID}/${filename}`);\n  storageRef.delete().then(() => {\n    fetchFiles();\n  }).catch(err => {\n    console.log(err);\n    window.alert(err.message);\n  });\n};\nexport const uploadFilesMethod = (auth, storage, files, fetchFiles, err) => {\n  const rejectedFiles = []; // upload accepted files to firebase\n\n  const UID = auth.currentUser.uid;\n  let counter = 0;\n  files.forEach((file, i) => {\n    const fileReader = new FileReader();\n    fileReader.readAsText(file);\n\n    fileReader.onloadend = () => {\n      // converts CSV's data to string\n      if (readString(fileReader.result).errors.length) {\n        rejectedFiles.push(file.name);\n        counter++;\n      } else {\n        const rows = readString(fileReader.result).data;\n        counter++;\n\n        if (rows[0].length !== 22) {\n          // checks row length for length of 22\n          rejectedFiles.push(file.name);\n        } else if (JSON.stringify(rows[0]) !== JSON.stringify(headers)) {\n          // Compares Depop headers to first row of file\n          rejectedFiles.push(file.name);\n        } else {\n          // File passed all tests so it's upload time now...\n          const storageRef = storage.ref(`${UID}/${file.name}`);\n          const uploadTask = storageRef.put(file);\n          uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, snapshot => {\n            switch (snapshot.state) {\n              case firebase.storage.TaskState.PAUSED:\n                console.log('Upload is paused');\n                break;\n\n              case firebase.storage.TaskState.RUNNING:\n                // console.log('Upload is running')\n                break;\n            }\n          }, error => {\n            switch (error.code) {\n              case 'storage/unauthorized':\n                window.alert(\"You don't have permission to execute this action.\");\n                break;\n\n              case 'storage/canceled':\n                window.alert('Unknown Error. Operation canceled');\n                break;\n\n              case 'storage/unknown':\n                window.alert('Unknown Error');\n                break;\n            }\n          }, () => {\n            if (counter === files.length) {\n              fetchFiles();\n            }\n          });\n        }\n\n        if (i === files.length - 1) {\n          if (rejectedFiles.length) {\n            err(`The following files were not processed because they are not Depop files: ${rejectedFiles.join(', ')}. If this seems to be an error, please contact samote.wood@gmail.com for support.`);\n          }\n        }\n      }\n    };\n  });\n};","map":null,"metadata":{},"sourceType":"module"}